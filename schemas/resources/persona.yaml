$schema: http://json-schema.org/draft-07/schema#

$id: https://metadata.afip.gob.ar/json-schemas/persona-v1.0.0#

x-common-properties: &common-properties
  tipoid:
    type: string
    enum: [C, E, I, L]
  activoid:
    $ref: "#/definitions/cuit"
  estado:
    type: string
    enum: [A, I]
  pais:
    type: integer
  ch:
    $ref: "#/definitions/ch"
  ds:
    $ref: "#/definitions/fecha"

x-personafisica-properties: &personafisica-properties
  tipo:
    const: F
  id:
    $ref: "#/definitions/cuitfisica"
  documento:
    $ref: "#/definitions/documento"
  nombre:
    type: string
    minLength: 1
  apellido:
    type: string
    minLength: 1
  materno:
    type: string
    minLength: 1
  sexo:
    type: string
    enum: [M, F]
  nacimiento:
    $ref: "#/definitions/fecha"
  fallecimiento:
    $ref: "#/definitions/fecha"

x-personajuridica-properties: &personajuridica-properties
  tipo:
    const: J
  id:
    $ref: "#/definitions/cuitjuridica"
  razonsocial:
    type: string
    minLength: 1
  formajuridica:
    type: integer
    minimum: 1
    maximum: 999
  mescierre:
    type: integer
    minimum: 1
    maximum: 12
  contratosocial:
    $ref: "#/definitions/fecha"
  duracion:
    type: integer
    minimum: 1
    maximum: 999
  inscripcion:
    type: object
    properties:
      numero:
        type: integer
      registro:
        type: integer
    additionalProperties: false
    required:
      - numero

x-common-collections: &common-collections
  actividades:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/actividad"
          - type: "null"
    additionalProperties: false
  impuestos:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/impuesto"
          - type: "null"
    additionalProperties: false
  domicilios:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/domicilio"
          - type: "null"
    additionalProperties: false
  telefonos:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/telefono"
          - type: "null"
    additionalProperties: false
  jurisdicciones:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/jurisdiccion"
          - type: "null"
    additionalProperties: false
  emails:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/email"
          - type: "null"
    additionalProperties: false
  archivos:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/archivo"
          - type: "null"
    additionalProperties: false
  categorias:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/categoria"
          - type: "null"
    additionalProperties: false
  etiquetas:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/etiqueta"
          - type: "null"
    additionalProperties: false
  contribmunis:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/contribucionmunicipal"
          - type: "null"
    additionalProperties: false
  relaciones:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/relacion"
          - type: "null"
    additionalProperties: false
  cmsedes:
    type: object
    patternProperties:
      '^[-0-9]+(\.[-0-9]+)*$':
        oneOf:
          - $ref: "#/definitions/cmsede"
          - type: "null"
    additionalProperties: false

#####################
# Esquema principal #
#####################

type: object
additionalProperties: false
required: [id]
minProperties: 2
properties:
  id:
    $ref: "#/definitions/cuit"
  persona:
    type: object
    oneOf:
      - type: object
        title: personafisica
        properties:
          <<: *common-properties
          <<: *personafisica-properties
        additionalProperties: false
        required:
          - tipo
          - id
          - tipoid
          - estado
          - apellido
      - type: object
        title: personajuridica
        properties:
          <<: *common-properties
          <<: *personajuridica-properties
        additionalProperties: false
        required:
          - tipo
          - id
          - tipoid
          - estado
          - razonsocial
  <<: *common-collections

################################

definitions:
  cuit:
    type: integer
    format: cuit

  cuitfisica:
    type: integer
    format: cuit
    minimum: 20000000000
    maximum: 29999999999

  cuitjuridica:
    type: integer
    format: cuit
    minimum: 30000000000
    maximum: 39999999999

  estado:
    type: string
    enum: [AC, NA, BD, BP, EX]

  fecha:
    type: string
    format: date

  provincia:
    type: integer
    minimum: 0
    maximum: 24

  periodomensual:
    type: integer
    minimum: 100000
    maximum: 999912
    format: periodomensual

  periododiario:
    type: integer
    minimum: 10000000
    maximum: 99991231
    format: periododiario

  codigoimpuesto:
    type: integer
    minimum: 1
    maximum: 9999

  actividad:
    type: object
    properties:
      actividad:
        type: string
        pattern: "^883-[0-9]{5,6}$"
      orden:
        type: integer
      desde:
        $ref: "#/definitions/periodomensual"
      hasta:
        $ref: "#/definitions/periodomensual"
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - actividad
      - orden
      - desde

  domicilio:
    type: object
    properties:
      nombre:
        type: string
      orden:
        type: integer
      tipo:
        type: integer
      estado:
        type: integer
      calle:
        type: string
      numero:
        type: integer
      piso:
        type: string
      sector:
        type: string
      manzana:
        type: string
      torre:
        type: string
      unidad:
        type: string
      provincia:
        $ref: "#/definitions/provincia"
      localidad:
        type: string
      cp:
        type: string
      nomenclador:
        type: integer
      adicional:
        type: object
        properties:
          tipo:
            type: integer
          dato:
            type: string
          additionalProperties: false
        required:
          - tipo
          - dato
      baja:
        $ref: "#/definitions/fecha"
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    minProperties: 3
    required:
      - orden
      - tipo

  impuesto:
    type: object
    properties:
      impuesto:
        $ref: "#/definitions/codigoimpuesto"
      inscripcion:
        $ref: "#/definitions/fecha"
      estado:
        $ref: "#/definitions/estado"
      dia:
        type: integer
        minimum: 1
        maximum: 31
      periodo:
        $ref: "#/definitions/periodomensual"
      motivo:
        type: integer
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - impuesto
      - periodo
      - estado

  telefono:
    type: object
    properties:
      orden:
        type: integer
      pais:
        type: integer
      area:
        type: integer
      numero:
        type: integer
      tipo:
        type: integer
      linea:
        type: integer
      estado:
        type: integer
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - orden
      - numero

  documento:
    type: object
    properties:
      tipo:
        type: integer
        minimum: 1
        maximum: 99
      numero:
        type: string
        minLength: 1
    additionalProperties: false
    required:
      - tipo
      - numero

  jurisdiccion:
    type: object
    properties:
      provincia:
        $ref: "#/definitions/provincia"
      desde:
        $ref: "#/definitions/fecha"
      hasta:
        $ref: "#/definitions/fecha"
      orgrec:
        type: integer
        minimum: 900
        maximum: 924
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - provincia
      - desde
      - orgrec

  email:
    type: object
    properties:
      direccion:
        type: string
        format: email
      orden:
        type: integer
      tipo:
        type: integer
      estado:
        type: integer
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - orden
      - direccion

  archivo:
    type: object
    properties:
      descripcion:
        type: string
      orden:
        type: integer
      tipo:
        type: integer
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - orden
      - tipo

  categoria:
    type: object
    properties:
      categoria:
        type: integer
      motivo:
        type: integer
      estado:
        $ref: "#/definitions/estado"
      impuesto:
        $ref: "#/definitions/codigoimpuesto"
      periodo:
        $ref: "#/definitions/periodomensual"
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - categoria
      - impuesto
      - periodo
      - estado

  etiqueta:
    type: object
    properties:
      etiqueta:
        type: integer
      periodo:
        $ref: "#/definitions/periododiario"
      estado:
        $ref: "#/definitions/estado"
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - etiqueta
      - periodo
      - estado

  contribucionmunicipal:
    type: object
    properties:
      impuesto:
        $ref: "#/definitions/codigoimpuesto"
      municipio:
        type: integer
        minimum: 1
      provincia:
        $ref: "#/definitions/provincia"
      desde:
        $ref: "#/definitions/fecha"
      hasta:
        $ref: "#/definitions/fecha"
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - impuesto
      - municipio
      - provincia
      - desde

  relacion:
    type: object
    properties:
      persona:
        $ref: "#/definitions/cuit"
      tipo:
        type: integer
      subtipo:
        type: integer
      desde:
        $ref: "#/definitions/fecha"
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - persona
      - tipo
      - subtipo
      - desde

  cmsede:
    type: object
    properties:
      provincia:
        $ref: "#/definitions/provincia"
      desde:
        $ref: "#/definitions/fecha"
      hasta:
        $ref: "#/definitions/fecha"
      ds:
        $ref: "#/definitions/fecha"
    additionalProperties: false
    required:
      - provincia
      - desde

  ch: # TODO ¿distinguir ch-fisica de ch-juridica para que no se permitan campos de persona fisica en un ch de persona jurídica y viceversa?
    type: array
    uniqueItems: true
    items:
      type: string
      enum:
        - activoid
        - apellido
        - contratosocial
        - documento
        - ds
        - estado
        - fallecimiento
        - formajuridica
        - id
        - inscripcion
        - materno
        - mescierre
        - nacimiento
        - nombre
        - pais
        - razonsocial
        - sexo
        - tipo
        - tipoid
